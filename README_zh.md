# 🎪 TRAELand

[English](./README.md)

![TRAELand 演示](./docs/images/demo.gif)

## 🎮 游戏简介

**TRAELand · 马年庙会** 是一款2D像素风俯视角游戏，以中国农历新年庙会为背景。玩家可以探索传统庙会，与AI驱动的NPC互动，体验放烟花、放孔明灯等新年传统活动。

## ✨ 核心特色

### 🤖 AI驱动的NPC系统
- **11个独特NPC**，每个都有独特的性格，由大语言模型(LLM)驱动
- 基于NPC性格动态生成对话
- 摊位前没人时，AI自动生成吆喝语
- 智能讨价还价和交易对话

### 🎆 烟花系统
- 三种主题烟花图案：**马**、**鱼**、**2026**
- AI生成带程序员梗的祝福语
- 祝福语示例："马年无Bug"、"内存有余"、"代码如马飞"

### 🏮 孔明灯场景
- 基于 **Three.js** 的震撼3D场景
- GPU Instancing 批量渲染3000+背景孔明灯
- 5000颗闪烁星星
- AI生成四字祝福语（支持程序员梗）

### 🛒 自动消费系统
- 10个AI控制的游客，各有不同性格
- 智能决策下一个要逛的摊位
- 真实的讨价还价对话
- 热门摊位排队系统

## 🛠️ 技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| 游戏引擎 | Phaser 3 | 3.90.0 |
| 3D引擎 | Three.js | 0.160.0 |
| AI服务 | 豆包/OpenAI | - |

## 📁 项目结构

```
├── html/                    # 前端代码
│   ├── js/
│   │   ├── scenes/         # 游戏场景
│   │   ├── entities/       # 游戏实体（玩家、NPC）
│   │   ├── utils/          # 工具类（AI、寻路、特效）
│   │   └── data/           # 游戏数据和NPC人设
│   └── assets/             # 游戏素材
```

## 🚀 快速开始

### 环境要求
- Python 3.x（本地服务器）
- LLM API Key（豆包或OpenAI）

### 配置 API Key

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑 .env 文件，填入你的 API Key
```

支持的 LLM 提供商：
| 提供商 | 环境变量配置 |
|--------|-------------|
| 豆包 | `LLM_PROVIDER=doubao`<br>`DOUBAO_API_KEY=你的密钥` |
| OpenAI | `LLM_PROVIDER=openai`<br>`OPENAI_API_KEY=你的密钥` |

### 本地运行

```bash

# 启动游戏
cd html
python3 serve.py
# 浏览器打开 http://localhost:8000

```

## 🎭 NPC角色

| NPC | 角色 | 性格特点 |
|-----|------|----------|
| 老村长 | 糖画摊主 | 热情好客，传统手艺人 |
| 王大妈 | 炸元宵摊主 | 八卦、爱攀比、喜欢PUA |
| 钱老板 | 饰品摊主 | 热衷催婚 |
| 泥人张 | 泥人摊主 | 朴实友善，为儿子发愁 |
| 李百万 | 套圈摊主 | 凡尔赛炫耀儿子 |
| 万兽王 | 小动物摊主 | 劝回老家当公务员 |
| 王婆 | 卖菜兼媒婆 | 热心介绍对象 |
| 爆竹秦 | 烟花摊主 | 热闹至上 |
| 郎百货 | 百货摊主 | 会讲故事 |
| 阿凡提 | 烤串摊主 | 幽默豪爽 |
| 孔明灯使者 | 孔明灯摊主 | 神秘浪漫 |

## 🎯 游戏流程

```
游戏开始
    ↓
10个游客生成，随机分配性格
    ↓
每个游客循环：
    → AI决定下一个要去的摊位
    → 走向摊位（A*寻路）
    → 与NPC进行AI对话
    → 购买并触发特效
    → 重复直到钱花完
    ↓
所有游客返回出发点
    ↓
孔明灯终场场景
```

## 🎨 游客类型

| 类型 | 特点 |
|------|------|
| 美食达人 | 对美食充满热情 |
| 年货采购员 | 精打细算，货比三家 |
| 收集爱好者 | 控制不住购买欲 |
| 热闹青年 | 喜欢凑热闹 |
| 宅家青年 | 被父母赶出来逛庙会 |
| 城里娃 | 对农村庙会感到新奇 |

## 🔧 AI功能列表

| 功能 | 说明 |
|------|------|
| `generateHawkingText()` | 生成NPC吆喝语 |
| `generateTradeDialogue()` | 生成交易对话 |
| `generateTouristResponse()` | 生成游客回复 |
| `generateTouristDecision()` | AI决定游客去哪个摊位 |
| `generateFireworkBlessing()` | 生成烟花祝福语（带程序员梗） |
| `generateKongmingBlessing()` | 生成孔明灯四字祝福语 |

## 🎇 烟花祝福语示例

| 烟花类型 | 祝福语示例 |
|----------|-----------|
| 马 | 马年无Bug、代码如马飞、马上不加班 |
| 鱼 | 年终奖有余、摸鱼大吉、内存有余 |
| 2026 | 2026.release()、新年git push |

## 🛍️ 商品价格表

| 商户 | 商品 | 价格 |
|------|------|------|
| 老村长 | 手工糖画 | 35元 |
| 王大妈 | 炸元宵 | 25元 |
| 钱老板 | 饰品 | 28元 |
| 泥人张 | 泥人 | 20元 |
| 李百万 | 套圈 | 30元 |
| 王婆 | 蔬菜 | 28元 |
| 万兽王 | 小动物 | 38元 |
| 爆竹秦 | 烟花 | 42元 |
| 郎百货 | 小物件 | 35元 |
| 阿凡提 | 烤串 | 40元 |
| 孔明灯使者 | 孔明灯 | 45元 |

## 📝 开源协议

版权所有 (c) 2026 Bytedance Ltd. and/or its affiliates。保留所有权利。
根据 [MIT License](https://opensource.org/licenses/MIT) 许可证授权。

---

## 🐴 丙午马年 · 程序员的赛博春联

**愿你的代码**  
像赤兔马一样 **快** —— O(1) 算法，零等待  
像的卢马一样 **稳** —— 100% 测试覆盖率，永不挂  
像绝影马一样 **久** —— 无技术债务，维护到退休  

```python
while 马年:
    coffee.brew()
    code.write()
    if 产品经理.需求变更():
        git.stash()
        refactor()
    else:
        print("Hello, 摸鱼~")
    git.push("--force-with-lease")  # 马年不破主干
```

**马年大吉！代码无Bug，上线不加班！** 🐴🎊💻
